<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AssemblerEmulator - Nikola Bebic: AssemblerEmulator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AssemblerEmulator - Nikola Bebic
   </div>
   <div id="projectbrief">Assembler and emulator used for systems software class</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">AssemblerEmulator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>System software</b></p>
<p><b>School of Electrical Engineering</b></p>
<p><b>University of Belgrade</b></p>
<p><b>Copyright © 2017 Nikola Bebić</b></p>
<h2>Quick Start</h2>
<p>This is a school project for the system software class. The purpose of the project is to write the assembler for the MicroRISC language and the emulator which would execute the programs produced by the assembler.</p>
<h2>Installation</h2>
<p>Just run the <code>build.sh</code> script and everything should be ready to go</p>
<h2>Usage</h2>
<p>Run the <code>run.sh</code> script with the -f option with the name of the <code>.ss</code> input file. The script will run the assembler with the input file, generate the output file, and run the emulator with that output file.</p>
<p>Example:</p>
<p><code>run.sh -f helloworld.ss</code></p>
<p>Input file: </p><div class="fragment"><div class="line">org 0x0</div><div class="line">.rodata.0</div><div class="line">    dd stack - 4</div><div class="line">    dd print_string_interrupt</div><div class="line">    dd 30 dup dummy</div><div class="line"></div><div class="line">org 128</div><div class="line">.data.0</div><div class="line">out: </div><div class="line">    dd 0</div><div class="line">in: </div><div class="line">    dd 0 </div><div class="line"></div><div class="line">.bss</div><div class="line">stack: </div><div class="line">    DW 0x100 DUP ?</div><div class="line"></div><div class="line">.text</div><div class="line">dummy: ret</div><div class="line"></div><div class="line">.global _start</div><div class="line">_start:</div><div class="line">    call hello</div><div class="line">    load r0, #0</div><div class="line">    int r0</div><div class="line"></div><div class="line">PRINT_STRING_INTERRUPT def 1</div><div class="line"></div><div class="line">hello:</div><div class="line">    load r0, #hello_string</div><div class="line">    load r15, #PRINT_STRING_INTERRUPT</div><div class="line">    int r15 ; calls print_string_interrupt</div><div class="line">    ret</div><div class="line"></div><div class="line">print_string:</div><div class="line">    loadub r1, [r0]</div><div class="line">    jz r1, skip</div><div class="line">    store r1, out</div><div class="line">    load r1, #1</div><div class="line">    add r0, r0, r1</div><div class="line">    jmp print_string</div><div class="line">skip:</div><div class="line">    ret;</div><div class="line"></div><div class="line">print_string_interrupt:</div><div class="line">    call print_string</div><div class="line">    ret </div><div class="line"></div><div class="line">.rodata.1</div><div class="line">hello_string:</div><div class="line">    DB &#39;H&#39;</div><div class="line">    DB &#39;e&#39; </div><div class="line">    DB &#39;l&#39; </div><div class="line">    DB &#39;l&#39; </div><div class="line">    DB &#39;o&#39; </div><div class="line">    DB &#39;,&#39; </div><div class="line">    DB &#39; &#39; </div><div class="line">    DB &#39;W&#39; </div><div class="line">    DB &#39;o&#39; </div><div class="line">    DB &#39;r&#39; </div><div class="line">    DB &#39;l&#39; </div><div class="line">    DB &#39;d&#39; </div><div class="line">    DB &#39;!&#39; </div><div class="line">    DB 10 ; CR</div><div class="line">    DB 13 ; LF</div><div class="line">    DB 0  ; end of string</div></div><!-- fragment --><p>Output: </p><div class="fragment"><div class="line">Hello, World!</div></div><!-- fragment --><h2>MicroRISC Specification</h2>
<h3>Architecture</h3>
<p>32-bit RISC processor</p>
<p>32-bit virtual address space, addressable unit - byte, little-endian</p>
<p>No floating point arithmetic</p>
<h3>Registers</h3>
<p>16 32-bit general purpose registers, <code>R0</code> - <code>R15</code></p>
<p>32-bit program counter: <code>PC</code></p>
<p>32-bit stack pointer: <code>SP</code>. Stack grows towards higher addresses, stack pointer points to the word at the top of the stack</p>
<h3>Constant terms</h3>
<p>Constant terms can containt the following:</p><ul>
<li>Literals</li>
<li>Arithmetic operators (+, -, *, /)</li>
<li>Subexpressions with parentheses</li>
</ul>
<p>Literals are signed decimal, binary or hexadecimal integers, or ASCII characters, as well as named constants or labels</p>
<p>Labels can can contain letters, digits, and symbol <code>_</code>, and can not start with a letter</p>
<p>There is a predefined symbol <code>$</code>, which represents the address of the current instruction</p>
<h3>Address modes</h3>
<ul>
<li>Immediate: <code>#constant_term</code></li>
<li>Register direct: <code>Ri</code></li>
<li>Register indirect: <code>[Ri]</code></li>
<li>Register indirect with offset: <code>[Ri + offset]</code>. <code>offset</code> is a constant term</li>
<li>PC relative: <code>$constant_term</code>. This is treated as register indirect with offset. Constant term must contain at least one label</li>
</ul>
<h3>Instructions</h3>
<p>Instruction format:</p>
<p><code>[label:] instruction [operand0, operand1, operand2] [; comment]</code></p>
<h4>Flow control instructions</h4>
<table class="doxtable">
<tr>
<td><em><b>Instruction</b></em> </td><td><em><b>Address modes</b></em> </td><td><em><b>Comment</b></em>  </td></tr>
<tr>
<td><code>INT op</code> </td><td>Register direct </td><td>Generates a software interrupt.<br />
 Interrupt entry is in the register  </td></tr>
<tr>
<td><code>JMP op</code> </td><td>Memory direct, register indirect,<br />
 register indirect with offset </td><td>Jumps to given address  </td></tr>
<tr>
<td><code>CALL op</code> </td><td>Memory direct, register indirect,<br />
 register indirect with offset </td><td>Calls a subroutine.<br />
 <code>PC</code> is pushed to the stack  </td></tr>
<tr>
<td><code>RET</code> </td><td>None </td><td>Returns from subroutine  </td></tr>
<tr>
<td><code>JZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg == 0</code>  </td></tr>
<tr>
<td><code>JNZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg != 0</code>  </td></tr>
<tr>
<td><code>JGZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg &gt; 0</code>  </td></tr>
<tr>
<td><code>JGEZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg &gt;= 0</code>  </td></tr>
<tr>
<td><code>JLZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg &lt; 0</code>  </td></tr>
<tr>
<td><code>JLEZ reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: Memory direct,<br />
 register indirect, register indirect with offset </td><td>Jumps to <code>op</code> if <code>reg &lt; 0</code>  </td></tr>
</table>
<h3>Load/Store instructions</h3>
<p>Load, sizes of operands:</p><ul>
<li>Unsigned byte, suffix: <code>UB</code></li>
<li>Signed byte, suffix: <code>SB</code></li>
<li>Unsigned word, suffix: <code>UW</code></li>
<li>Signed word, suffix: <code>SW</code></li>
<li>Double word, no suffix</li>
</ul>
<p>Store, sizes of the operands:</p><ul>
<li>Byte, suffix: <code>B</code></li>
<li>Word, suffix: <code>W</code></li>
<li>Double word, no suffix</li>
</ul>
<p>Size of word is 2 bytes, and size of double word is 2 words</p>
<table class="doxtable">
<tr>
<td><em><b>Instruction</b></em> </td><td><em><b>Address modes</b></em> </td><td><em><b>Comment</b></em>  </td></tr>
<tr>
<td><code>LOAD reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: All </td><td>Loads the data into the register  </td></tr>
<tr>
<td><code>STORE reg, op</code> </td><td><code>reg</code>: Register direct, <code>op</code>: All except immediate </td><td>Stores the data from the register  </td></tr>
</table>
<h3>Stack instructions</h3>
<ul>
<li>32-bit double word is always pushed to the stack, and popped from the stack</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Instruction</b></em> </td><td><em><b>Address modes</b></em> </td><td><em><b>Comment</b></em>  </td></tr>
<tr>
<td><code>PUSH reg</code> </td><td>Register direct </td><td>Pushes the register to the stack  </td></tr>
<tr>
<td><code>POP reg</code> </td><td>Register direct </td><td>Pops the register from the stack  </td></tr>
</table>
<h3>ALU instructions</h3>
<ul>
<li>Work only on 32-bit operands</li>
<li>Signed arithmetic</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Instruction</b></em> </td><td><em><b>Address modes</b></em> </td><td><em><b>Comment</b></em>  </td></tr>
<tr>
<td><code>ADD reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 + reg2</code>  </td></tr>
<tr>
<td><code>SUB reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 - reg2</code>  </td></tr>
<tr>
<td><code>MUL reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 * reg2</code>  </td></tr>
<tr>
<td><code>DIV reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 / reg2</code>  </td></tr>
<tr>
<td><code>MOD reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 % reg2</code>  </td></tr>
<tr>
<td><code>AND reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 &amp; reg2</code>  </td></tr>
<tr>
<td><code>OR reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 | reg2</code>  </td></tr>
<tr>
<td><code>XOR reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 ^ reg2</code>  </td></tr>
<tr>
<td><code>NOT reg0, reg1</code> </td><td>Register direct </td><td><code>reg0 = ~reg1</code>  </td></tr>
<tr>
<td><code>ASL reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 &lt;&lt; reg2</code>  </td></tr>
<tr>
<td><code>ASR reg0, reg1, reg2</code> </td><td>Register direct </td><td><code>reg0 = reg1 &gt;&gt; reg2</code>  </td></tr>
</table>
<h3>Data definition</h3>
<p>Format:</p>
<p><code>[label:] definition data_specifier [, ...] [; comment]</code></p>
<p>Possible definitions:</p><ul>
<li><code>DB</code> - defines a byte</li>
<li><code>DW</code> - defines a word</li>
<li><code>DD</code> - defines a double word</li>
</ul>
<p>Data specifiers:</p>
<p><code>constant_term [ DUP constant_term | ? ]</code></p>
<ul>
<li><code>DUP</code> - First constant term denotes how many times the second constant term will occur</li>
<li><code>?</code> - Undefined value</li>
</ul>
<h3>Directives:</h3>
<p>Named constant definition:</p>
<p><code>symbol DEF constant_expression [; comment]</code></p>
<p>Origin directive:</p>
<p><code>ORG constant_expression [; comment]</code></p>
<h3>Segments</h3>
<ul>
<li><code>.text[.number]</code> - section containing the program code</li>
<li><code>.data[.number]</code> - section containing initialized data</li>
<li><code>.rodata[.number]</code> - section containing read only data</li>
<li><code>.bss[.number]</code> - section containing uninitialized data</li>
</ul>
<h3>Interrupts:</h3>
<ul>
<li>IV table starts at the address 0 and has 32 entries</li>
<li>During the interrupt execution, no hardware interrupt can happen</li>
<li>Executing <code>INT 0</code> will end the program</li>
<li>Entry 0 in the IVT contains the starting value of the stack pointer</li>
<li>Entry 3 in the IVT contains the address of the error interrupt routine</li>
<li>Entry 4 in the IVT contains the address of the timer interrupt routine. This routine is called every <code>0,1s</code></li>
<li>Entry 5 in the IVT contains the address of the keyboard interrupt routine. This routine is called every time a key is pressed</li>
</ul>
<p>Two registers are mapped in the address space, right after the IV table.</p>
<p>The first register is mapped to the address <code>128</code> and is the <code>stdout</code> register. Every time a value is written to this register, it will be written on the standard output stream</p>
<p>The second register is mapped to the address <code>132</code> and is the <code>stdin</code> register. Every time a keyboard interrupt happens, this register will contain the ASCII code of the hit character. The value can be read more than once. New interrupts will not happen until the value is read at least once</p>
<h2>Licence</h2>
<p>MIT License</p>
<p>Copyright (c) 2017 Nikola Bebic</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
